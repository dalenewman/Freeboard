(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../fold/xml-fold")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],n):n(CodeMirror)})(function(n){function e(t){var h,p,b,y,e,l,k;if(t.getOption("disableInput"))return n.Pass;for(h=t.listSelections(),p=[],e=0;e<h.length;e++){if(!h[e].empty())return n.Pass;var s=h[e].head,o=t.getTokenAt(s),w=n.innerMode(t.getMode(),o.state),a=w.state;if(w.mode.name!="xml"||!a.tagName)return n.Pass;var v=t.getOption("autoCloseTags"),d=w.mode.configuration=="html",g=typeof v=="object"&&v.dontCloseTags||d&&u,nt=typeof v=="object"&&v.indentTags||d&&f,c=a.tagName;if(o.end>s.ch&&(c=c.slice(0,c.length-o.end+s.ch)),b=c.toLowerCase(),!c||o.type=="string"&&(o.end!=s.ch||!/[\"\']/.test(o.string.charAt(o.string.length-1))||o.string.length==1)||o.type=="tag"&&a.type=="closeTag"||o.string.indexOf("/")==o.string.length-1||g&&i(g,b)>-1||r(t,c,s,a,!0))return n.Pass;y=nt&&i(nt,b)>-1;p[e]={indent:y,text:">"+(y?"\n\n":"")+"<\/"+c+">",newPos:y?n.Pos(s.line+1,0):n.Pos(s.line,s.ch+1)}}for(e=h.length-1;e>=0;e--)l=p[e],t.replaceRange(l.text,h[e].head,h[e].anchor,"+insert"),k=t.listSelections().slice(0),k[e]={head:l.newPos,anchor:l.newPos},t.setSelections(k),l.indent&&(t.indentLine(l.newPos.line,null,!0),t.indentLine(l.newPos.line+1,null,!0))}function t(t,i){for(var f=t.listSelections(),o=[],c=i?"/":"<\/",u=0;u<f.length;u++){if(!f[u].empty())return n.Pass;var l=f[u].head,s=t.getTokenAt(l),h=n.innerMode(t.getMode(),s.state),e=h.state;if(i&&(s.type=="string"||s.string.charAt(0)!="<"||s.start!=l.ch-1))return n.Pass;if(h.mode.name!="xml")if(t.getMode().name=="htmlmixed"&&h.mode.name=="javascript")o[u]=c+"script>";else if(t.getMode().name=="htmlmixed"&&h.mode.name=="css")o[u]=c+"style>";else return n.Pass;else{if(!e.context||!e.context.tagName||r(t,e.context.tagName,l,e))return n.Pass;o[u]=c+e.context.tagName+">"}}for(t.replaceSelections(o),f=t.listSelections(),u=0;u<f.length;u++)(u==f.length-1||f[u].head.line<f[u+1].head.line)&&t.indentLine(f[u].head.line)}function o(i){if(i.getOption("disableInput"))return n.Pass;t(i,!0)}function i(n,t){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;++i)if(n[i]==t)return i;return-1}function r(t,i,r,u,f){var h,o,e,c,l,s;if(!n.scanForClosingTag||(h=Math.min(t.lastLine()+1,r.line+500),o=n.scanForClosingTag(t,r,null,h),!o||o.tag!=i))return!1;for(e=u.context,c=f?1:0;e&&e.tagName==i;e=e.prev)++c;for(r=o.to,l=1;l<c;l++){if(s=n.scanForClosingTag(t,r,null,h),!s||s.tag!=i)return!1;r=s.to}return!0}n.defineOption("autoCloseTags",!1,function(t,i,r){if(r!=n.Init&&r&&t.removeKeyMap("autoCloseTags"),i){var u={name:"autoCloseTags"};(typeof i!="object"||i.whenClosing)&&(u["'/'"]=function(n){return o(n)});(typeof i!="object"||i.whenOpening)&&(u["'>'"]=function(n){return e(n)});t.addKeyMap(u)}});var u=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],f=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];n.commands.closeTag=function(n){return t(n)}});
//# sourceMappingURL=closetag.min.js.map
