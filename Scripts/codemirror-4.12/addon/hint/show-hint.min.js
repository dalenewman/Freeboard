(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function u(n,t){this.cm=n;this.options=this.buildOptions(t);this.widget=this.onClose=null}function f(n){return typeof n=="string"?n:n.text}function s(n,t){function o(n,i){var r;r=typeof i!="string"?function(n){return i(n,t)}:f.hasOwnProperty(i)?f[i]:i;e[n]=r}var f={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(-t.menuSize()+1,!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Home:function(){t.setFocus(0)},End:function(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},r=n.options.customKeys,e=r?{}:f,u,i;if(r)for(i in r)r.hasOwnProperty(i)&&o(i,r[i]);if(u=n.options.extraKeys,u)for(i in u)u.hasOwnProperty(i)&&o(i,u[i]);return e}function e(n,t){while(t&&t!=n){if(t.nodeName.toUpperCase()==="LI"&&t.parentNode==n)return t;t=t.parentNode}}function i(i,r){var p,y,w,g,h,et,nt,ot,rt,tt,st,ut;this.completion=i;this.data=r;var l=this,c=i.cm,u=this.hints=document.createElement("ul");for(u.className="CodeMirror-hints",this.selectedHint=r.selectedHint||0,p=r.list,y=0;y<p.length;++y){var b=u.appendChild(document.createElement("li")),v=p[y],it=o+(y!=this.selectedHint?"":" "+t);v.className!=null&&(it=v.className+" "+it);b.className=it;v.render?v.render(b,r,v):b.appendChild(document.createTextNode(v.displayText||f(v)));b.hintId=y}var a=c.cursorCoords(i.options.alignWithWord?r.from:null),k=a.left,d=a.bottom,ft=!0;if(u.style.left=k+"px",u.style.top=d+"px",w=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),g=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),(i.options.container||document.body).appendChild(u),h=u.getBoundingClientRect(),et=h.bottom-g,et>0&&(nt=h.bottom-h.top,ot=a.top-(a.bottom-h.top),ot-nt>0?(u.style.top=(d=a.top-nt)+"px",ft=!1):nt>g&&(u.style.height=g-5+"px",u.style.top=(d=a.bottom-h.top)+"px",rt=c.getCursor(),r.from.ch!=rt.ch&&(a=c.cursorCoords(rt),u.style.left=(k=a.left)+"px",h=u.getBoundingClientRect()))),tt=h.right-w,tt>0&&(h.right-h.left>w&&(u.style.width=w-5+"px",tt-=h.right-h.left-w),u.style.left=(k=a.left-tt)+"px"),c.addKeyMap(this.keyMap=s(i,{moveFocus:function(n,t){l.changeActive(l.selectedHint+n,t)},setFocus:function(n){l.changeActive(n)},menuSize:function(){return l.screenAmount()},length:p.length,close:function(){i.close()},pick:function(){l.pick()},data:r})),i.options.closeOnUnfocus){c.on("blur",this.onBlur=function(){st=setTimeout(function(){i.close()},100)});c.on("focus",this.onFocus=function(){clearTimeout(st)})}ut=c.getScrollInfo();c.on("scroll",this.onScroll=function(){var t=c.getScrollInfo(),r=c.getWrapperElement().getBoundingClientRect(),f=d+ut.top-t.top,n=f-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(ft||(n+=u.offsetHeight),n<=r.top||n>=r.bottom)return i.close();u.style.top=f+"px";u.style.left=k+ut.left-t.left+"px"});n.on(u,"dblclick",function(n){var t=e(u,n.target||n.srcElement);t&&t.hintId!=null&&(l.changeActive(t.hintId),l.pick())});n.on(u,"click",function(n){var t=e(u,n.target||n.srcElement);t&&t.hintId!=null&&(l.changeActive(t.hintId),i.options.completeOnSingleClick&&l.pick())});n.on(u,"mousedown",function(){setTimeout(function(){c.focus()},20)});return n.signal(r,"select",p[0],u.firstChild),!0}var o="CodeMirror-hint",t="CodeMirror-hint-active",r;n.showHint=function(n,t,i){var r,u;if(!t)return n.showHint(i);if(i&&i.async&&(t.async=!0),r={hint:t},i)for(u in i)r[u]=i[u];return n.showHint(r)};n.defineExtension("showHint",function(t){if(!(this.listSelections().length>1)&&!this.somethingSelected()){this.state.completionActive&&this.state.completionActive.close();var i=this.state.completionActive=new u(this,t),r=i.options.hint;if(r)if(n.signal(this,"startCompletion",this),r.async)r(this,function(n){i.showHints(n)},i.options);else return i.showHints(r(this,i.options))}});u.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.widget&&this.widget.close(),this.onClose&&this.onClose(),n.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(t,i){var r=t.list[i];r.hint?r.hint(this.cm,t,r):this.cm.replaceRange(f(r),r.from||t.from,r.to||t.to,"complete");n.signal(t,"pick",r);this.close()},showHints:function(n){if(!n||!n.list.length||!this.active())return this.close();this.options.completeSingle&&n.list.length==1?this.pick(n,0):this.showWidget(n)},showWidget:function(t){function o(){f||(f=!0,r.close(),r.cm.off("cursorActivity",h),t&&n.signal(t,"close"))}function y(){if(!f){n.signal(t,"update");var i=r.options.hint;i.async?i(r.cm,s,r.options):s(i(r.cm,r.options))}}function s(n){if(t=n,!f){if(!t||!t.list.length)return o();r.widget&&r.widget.close();r.widget=new i(r,t)}}function p(){u&&(v(u),u=0)}function h(){p();var n=r.cm.getCursor(),t=r.cm.getLine(n.line);n.line!=e.line||t.length-n.ch!=l-e.ch||n.ch<e.ch||r.cm.somethingSelected()||n.ch&&c.test(t.charAt(n.ch-1))?r.close():(u=a(y),r.widget&&r.widget.close())}this.widget=new i(this,t);n.signal(t,"shown");var u=0,r=this,f,c=this.options.closeCharacters,e=this.cm.getCursor(),l=this.cm.getLine(e.line).length,a=window.requestAnimationFrame||function(n){return setTimeout(n,1e3/60)},v=window.cancelAnimationFrame||clearTimeout;this.cm.on("cursorActivity",h);this.onClose=o},buildOptions:function(n){var i=this.cm.options.hintOptions,u={};for(var t in r)u[t]=r[t];if(i)for(t in i)i[t]!==undefined&&(u[t]=i[t]);if(n)for(t in n)n[t]!==undefined&&(u[t]=n[t]);return u}};i.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var n=this.completion.cm;this.completion.options.closeOnUnfocus&&(n.off("blur",this.onBlur),n.off("focus",this.onFocus));n.off("scroll",this.onScroll)}},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,r){if(i>=this.data.list.length?i=r?this.data.list.length-1:0:i<0&&(i=r?0:this.data.list.length-1),this.selectedHint!=i){var u=this.hints.childNodes[this.selectedHint];u.className=u.className.replace(" "+t,"");u=this.hints.childNodes[this.selectedHint=i];u.className+=" "+t;u.offsetTop<this.hints.scrollTop?this.hints.scrollTop=u.offsetTop-3:u.offsetTop+u.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=u.offsetTop+u.offsetHeight-this.hints.clientHeight+3);n.signal(this.data,"select",this.data.list[this.selectedHint],u)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};n.registerHelper("hint","auto",function(t,i){var f=t.getHelpers(t.getCursor(),"hint"),e,r,u;if(f.length){for(r=0;r<f.length;r++)if(u=f[r](t,i),u&&u.list.length)return u}else if(e=t.getHelper(t.getCursor(),"hintWords")){if(e)return n.hint.fromList(t,{words:e})}else if(n.hint.anyword)return n.hint.anyword(t,i)});n.registerHelper("hint","fromList",function(t,i){for(var o,u=t.getCursor(),r=t.getTokenAt(u),f=[],e=0;e<i.words.length;e++)o=i.words[e],o.slice(0,r.string.length)==r.string&&f.push(o);if(f.length)return{list:f,from:n.Pos(u.line,r.start),to:n.Pos(u.line,r.end)}});n.commands.autocomplete=n.showHint;r={hint:n.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};n.defineOption("hintOptions",null)});
//# sourceMappingURL=show-hint.min.js.map
